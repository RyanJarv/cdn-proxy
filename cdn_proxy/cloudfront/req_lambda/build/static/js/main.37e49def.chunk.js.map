{"version":3,"sources":["Help.tsx","CloudFrontScanner.ts","Scanner.tsx","App.tsx","index.tsx"],"names":["Help","Container","className","href","xmlns","width","height","viewBox","role","fillRule","clipRule","d","fill","CloudFrontScanner","cdnProxy","hostnames","this","length","Error","backendHost","qs","fetch","redirect","backends","onfulfilled","onrejected","backend","cdnRequest","then","columns","dataField","text","Scanner","useState","ipRange","setIpRange","window","location","protocol","hostname","scanner","products","setProducts","Form","Row","Col","sm","Button","variant","type","onClick","input","addr","Address4","start","Number","startAddress","bigInteger","numIps","endAddress","ips","i","push","fromInteger","correctForm","textToIps","ip","resp","console","log","prev","prevCopy","slice","status","toString","Group","Control","placeholder","onChange","e","currentTarget","value","Text","keyField","data","OurNavBar","props","Navbar","bg","expand","Brand","name","Toggle","Collapse","id","Nav","to","Link","OurNavBarRouter","path","App","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.37e49def.chunk.js","sourcesContent":["import Container from \"react-bootstrap/Container\";\nimport React from \"react\";\n\nconst Help = () => (\n    <Container>\n        <Container className=\"title d-flex align-items-center pb-3 mb-5 border-bottom\">\n            <a href=\"/\" className=\"d-flex align-items-center text-dark text-decoration-none\">\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"40\" height=\"32\" className=\"me-2\" viewBox=\"0 0 118 94\"\n                     role=\"img\">\n                    <title>CDN Proxy Help</title>\n                    <path\n                        fillRule=\"evenodd\"\n                        clipRule=\"evenodd\"\n                        d=\"M24.509 0c-6.733 0-11.715 5.893-11.492 12.284.214 6.14-.064 14.092-2.066 20.577C8.943 39.365 5.547 43.485 0 44.014v5.972c5.547.529 8.943 4.649 10.951 11.153 2.002 6.485 2.28 14.437 2.066 20.577C12.794 88.106 17.776 94 24.51 94H93.5c6.733 0 11.714-5.893 11.491-12.284-.214-6.14.064-14.092 2.066-20.577 2.009-6.504 5.396-10.624 10.943-11.153v-5.972c-5.547-.529-8.934-4.649-10.943-11.153-2.002-6.484-2.28-14.437-2.066-20.577C105.214 5.894 100.233 0 93.5 0H24.508zM80 57.863C80 66.663 73.436 72 62.543 72H44a2 2 0 01-2-2V24a2 2 0 012-2h18.437c9.083 0 15.044 4.92 15.044 12.474 0 5.302-4.01 10.049-9.119 10.88v.277C75.317 46.394 80 51.21 80 57.863zM60.521 28.34H49.948v14.934h8.905c6.884 0 10.68-2.772 10.68-7.727 0-4.643-3.264-7.207-9.012-7.207zM49.948 49.2v16.458H60.91c7.167 0 10.964-2.876 10.964-8.281 0-5.406-3.903-8.178-11.425-8.178H49.948z\"\n                        fill=\"currentColor\"\n                    />\n                </svg>\n                <span className=\"fs-4\">CDN Proxy Help</span>\n            </a>\n        </Container>\n        <h3>Headers</h3>\n        <dl className=\"row\">\n            <dt className=\"col-sm-3\">Cdn-Proxy-Origin</dt>\n            <dd className=\"col-sm-9\">\n                <p>\n                    The origin the request should be routed to after passing through CloudFront.\n                </p>\n                <p>\n                    This header is Required. If you are seeing this page it is because this header was not\n                    included in the request to CloudFront.\n                </p>\n                <p>\n                    You can set this to a hostname or an IP, however because CloudFront only supports hostnames for\n                    origins any\n                    IP will be replaced with the equivalent domain using <a href=\"https://sslip.io\">sslip.io</a>.\n                </p>\n            </dd>\n\n            <dt className=\"col-sm-3\">Cdn-Proxy-Host</dt>\n            <dd className=\"col-sm-9\">\n                <p>\n                    Value of the Host header in the request to the origin.\n                </p>\n                <p>\n                    This header is optional but recommended. If not set it will default to the value of\n                    Cdn-Proxy-Origin.\n                </p>\n            </dd>\n\n            <dt className=\"col-sm-3\">X-Forwarded-For</dt>\n            <dd className=\"col-sm-9\">\n                <p>\n                    Passed through to the origin if set (like most other non-listed headers).\n                </p>\n                <p>\n                    If this header is not set it defaults to a randomized IP address in the request to the origin.\n                    This allows\n                    for bypassing IP based rate limiting in the backend in some cases.\n                </p>\n                <p>\n                    You may also want to try setting this to trusted values such as 127.0.0.1 or another internal IP\n                    address to\n                    expose any administrative or debug pages restricted by IP in the web application (compared to\n                    restrictions\n                    enforced in CloudFront/WAF, which will already be disabled when using this proxy).\n                </p>\n                <p>\n                    Multiple caching proxies are sometimes used in front of the origin, say CloudFront routes to\n                    Varnish which\n                    routes to nginx. In cases like this, where you are using the nginx service as the origin, you\n                    may need to\n                    set the target IP you want to add multiple IPs to this header with the one you want to spoof on\n                    the far\n                    left (example: X-Forwarded-For: 127.0.0.1, 172.32.10.10). It's also possible the second IP here\n                    needs to be\n                    a trusted IP on the internal network of the origin.\n                </p>\n            </dd>\n        </dl>\n\n        <hr className=\"col-3 col-md-2 mb-5\"/>\n\n        <h3>Examples</h3>\n        <dl className=\"row\">\n            <dt className=\"col-sm-3\">Curl -- No Host Header</dt>\n            <dd className=\"col-sm-9\">\n                <p>\n                    Here we are simply forwarding to the public ifconfig.me service after the request passes\n                    through CloudFront.\n                    The IP returned will be the source IP our request made from the CloudFront network. We don't\n                    need to set\n                    Cdn-Proxy-Host because ifconfig.me responds the same regardless of what the host header is\n                    set to.\n                </p>\n                <pre><code className=\"example\">\ncurl -H 'Cdn-Proxy-Origin: ifconfig.me' -H 'Cdn-Proxy-Host: ifconfig.me' XXXXXXXXXXXXX.cloudfront.net\n                    </code></pre>\n            </dd>\n            <dt className=\"col-sm-3\">Curl -- EC2 Origin</dt>\n            <dd className=\"col-sm-9\">\n                <p>\n                    More likely you'll be running something like this, where Cdn-Proxy-Origin is a specific\n                    backend server and\n                    Cdn-Proxy-Host is the domain name of the website it is running. If Cdn-Proxy-Host is not set\n                    correctly you\n                    may not be able to reach the site, but this depends on the server configuration.\n                </p>\n                <pre><code className=\"example\">\n            curl -H 'Cdn-Proxy-Origin: ec2-XX-XX-XX-XX.us-west-2.compute.amazonaws.com' -H 'Cdn-Proxy-Host: example.com' XXXXXXXXXXXXX.cloudfront.net\n                    </code></pre>\n                </dd>\n            </dl>\n    </Container>\n);\n\nexport default Help;","import {Address4} from \"ip-address\";\n\n\nexport class CloudFrontScanner {\n  readonly hostnames: Array<string>;\n  readonly cdnProxy: string;\n\n  constructor(cdnProxy: string, hostnames: Array<string> = []) {\n    this.cdnProxy = cdnProxy;\n\n    if (hostnames.length > 1) {\n      throw new Error('Using more then one hostname is not supported currently!')\n    }\n    this.hostnames = hostnames;\n  }\n\n\n  // TODO: We'll actually be passing a list of ips/dns records, along with preconfigured path, scheme, and list of\n  //  host headers. Only one host header is supported now, but later this list will include hosts we want to test for\n  //  each ip/domain and scheme combination. This allows for brute forcing the domain when we have several we might be\n  //  expecting.\n  // TODO: We can't set these headers in the browser, need to make them query parameters instead.\n  public cdnRequest(backendHost: string): Promise<Response> {\n    let qs = '?cdn-proxy-origin=' + backendHost\n\n    if (this.hostnames.length > 0) {\n      qs += '&cdn-proxy-host=' + this.hostnames[0]\n    } else {\n      qs += '&cdn-proxy-host=' + backendHost\n    }\n\n    return fetch(this.cdnProxy + qs, {\n      redirect: \"manual\",\n    })\n  }\n\n  scan(\n      backends: Array<string>,\n      onfulfilled?: ((resp: Response) => any),\n      onrejected?: ((reason: any) => any),\n  ) {\n    for (const backend of backends) {\n      this.cdnRequest(backend).then(onfulfilled, onrejected)\n    }\n  }\n}\n\n\nexport function textToIps(input: string): Array<string> {\n  let addr: Address4 = new Address4(input)\n\n  // Not sure why they use BigInt here, more then enough numbers to hold an IPv4 address\n  let start = Number(addr.startAddress().bigInteger())\n  let end = Number(addr.endAddress().bigInteger())\n  let numIps = (end - start)\n\n  // While typically the first and last IPs of a CIDR aren't used, the CIDR input here will likely not map to the real\n  // CIDR used for thee network at the destination.\n  let ips = []\n  for (let i = 0; i <= numIps; i++) {\n    ips.push(Address4.fromInteger(start + i).correctForm())\n  }\n  return ips\n}","import React, {ChangeEvent, useState} from \"react\";\nimport {Button, Col, Form, Row} from \"react-bootstrap\";\nimport Container from \"react-bootstrap/Container\";\nimport {CloudFrontScanner, textToIps} from \"./CloudFrontScanner\";\nimport BootstrapTable from 'react-bootstrap-table-next';\n\nconst columns = [{\n  dataField: 'origin',\n  text: 'Origin'\n}, {\n  dataField: 'result',\n  text: 'Result'\n}];\n\n\nfunction Scanner() {\n    const [ipRange, setIpRange] = useState(\"\");\n    const [scanner,] = useState(new CloudFrontScanner(window.location.protocol + '//' + window.location.hostname));\n    let [products, setProducts] = useState<Array<{ id: Number, origin: string; result: string; }>>([]);\n\n\n    return <Container>\n            <Form>\n                <Row>\n                    <Col sm={1}>\n                        <Button\n                            variant=\"primary\"\n                            type=\"submit\"\n                            onClick={() => {\n                                for (const ip of textToIps(ipRange)) {\n                                    scanner.cdnRequest(ip).then((resp) => {\n                                            console.log(\"got successful response from \" + ip);\n                                            console.log(resp);\n                                            setProducts((prev) => {\n                                                let prevCopy = prev.slice()\n                                                prevCopy.push({\n                                                    'id': products.length,\n                                                    'origin': ip,\n                                                    'result': resp.status.toString(),\n                                                }); return prevCopy\n                                            })\n                                        },\n                                        (resp) => {\n                                            console.log(\"got error response from \" + ip);\n                                            console.log(resp);\n                                            setProducts((prev) => {\n                                                let prevCopy = prev.slice()\n                                                prevCopy.push({\n                                                    'id': products.length,\n                                                    'origin': ip,\n                                                    'result': \"request failed\",\n                                                }); return prevCopy\n                                            })\n                                        }\n                                    );\n                                }\n                            }}\n                        >\n                            Submit\n                        </Button>\n                    </Col>\n\n                    <Col sm={4}>\n                        <Form.Group>\n                          {/*<Form.Label>IPs to Scan</Form.Label>*/}\n                          <Form.Control type=\"text\" placeholder=\"IP CIDR\" onChange={(e: ChangeEvent<HTMLInputElement>) => {\n                              setIpRange(e.currentTarget.value);\n                          }} />\n                          <Form.Text>\n                            Enter the IP range to scan in CIDR notation.\n                          </Form.Text>\n                        </Form.Group>\n                    </Col>\n\n                </Row>\n            </Form>\n        <Row>\n            <Col sm={12}>\n                <BootstrapTable keyField='id' data={ products } columns={ columns } />\n            </Col>\n        </Row>\n    </Container>\n}\n\nexport default Scanner;\n","import React from 'react';\nimport {HashRouter, Route, Switch} from 'react-router-dom';\nimport {LinkContainer} from 'react-router-bootstrap';\n\nimport {Nav, Navbar, Row} from \"react-bootstrap\";\nimport Container from \"react-bootstrap/Container\";\n\nimport './App.css';\nimport Help from \"./Help\";\nimport Scanner from \"./Scanner\";\n\nconst OurNavBar = (props: any) => (\n    <Navbar bg=\"light\" expand=\"lg\">\n        <Container>\n            <Navbar.Brand href=\"#home\">{props.name}</Navbar.Brand>\n            <Navbar.Toggle aria-controls=\"basic-navbar-nav\" />\n            <Navbar.Collapse id=\"basic-navbar-nav\">\n                <Nav className=\"me-auto\">\n                    <LinkContainer to=\"/\">\n                        <Nav.Link>Home</Nav.Link>\n                    </LinkContainer>\n                    <LinkContainer to=\"/scanner\">\n                        <Nav.Link>Scanner</Nav.Link>\n                    </LinkContainer>\n                </Nav>\n            </Navbar.Collapse>\n        </Container>\n    </Navbar>\n);\n\nconst OurNavBarRouter = () => (\n    <HashRouter>\n        <Switch>\n            <Route path=\"/scanner\">\n                <Row>\n                    <OurNavBar name=\"Scanner\" />\n                </Row>\n                <Row>\n                    <Scanner/>\n                </Row>\n            </Route>\n            <Route path=\"/\">\n                <Row>\n                    <OurNavBar name=\"Home\" />\n                </Row>\n                <Row>\n                    <Help/>\n                </Row>\n            </Route>\n        </Switch>\n    </HashRouter>\n);\n\nconst App = () => (\n    <Container>\n        <OurNavBarRouter/>\n        <footer className=\"pt-5 my-5 text-muted border-top\">\n            Created by the RhinoSecurityLabs team &middot; &copy; 2021\n        </footer>\n    </Container>\n);\n\nexport default App;","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);"],"sourceRoot":""}